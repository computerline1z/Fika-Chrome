"use strict";App.module.extend("reader",function(){var u=this,t=null,l={rtl:["ar","arc","dv","fa","ha","he","khw","ks","ku","ps","ur","yi"],cssPrefix:"font-",typeface:[{lang:["zh","zh-cn","zh-tw"],script:"chinese",default:0,fonts:[{name:"黑体",class:"heiti"},{name:"宋体",class:"songti"},{name:"楷体",class:"kaiti"},{name:"圆体",class:"yuanti"}]},{lang:["jp"],script:"japanese",default:0,fonts:[{name:"明朝体",class:"mincho"},{name:"ゴシック体",class:"gothic"},{name:"丸ゴシック体",class:"maru"}]},{lang:["af","be","bg","ca","co","cs","cy","da","de","en","eo","es","et","eu","fi","fr","fy","ga","gl","hr","hu","id","ig","is","it","kk","ku","la","lb","lt","lv","mg","mk","mn","ms","mt","nl","no","ny","pl","pt","ro","ru","sk","sl","sm","sn","so","sq","sr","sv","sw","tg","tl","tr","uk","uz","vi","xh","yo","zu"],script:"latin",default:2,fonts:[{name:"Arial",class:"arial"},{name:"Courier",class:"courier"},{name:"Georgia",class:"georgia"},{name:"Merriweather",class:"merriweather"},{name:"Open Sans",class:"openSans"},{name:"Palatino",class:"palatino"}]},{lang:[],script:"others",default:0,fonts:[{name:"Arial",class:"arial"},{name:"Times New Roman",class:"times"}]}]};this.ripple=function(e){e&&Array.from(e).forEach(function(s){s.addEventListener("click",function(e){var a=s.getBoundingClientRect();s.classList.add("fika-ripple-container");var t=document.createElement("span");t.className="fika-ripple",t.style.height=t.style.width=Math.max(a.width,a.height)+"px",s.appendChild(t);var n=e.pageY-a.top-t.offsetHeight/2-document.body.scrollTop,i=e.pageX-a.left-t.offsetWidth/2-document.body.scrollLeft;t.style.top=n+"px",t.style.left=i+"px",t.classList.add("active"),setTimeout(function(){t.remove()},1e3)},!1)})},this.toggleAppearanceMenu=function(e){var a=$(".fika-menu");void 0===e||e?(a.toggleClass("fika-menu-on"),t.overlay.toggleClass("fika-overlay-standby")):(a.removeClass("fika-menu-on"),t.overlay.removeClass("fika-overlay-standby"))},this.appearance=function(c,e){var a=e.fontSize,t=e.theme,r=e.font,f={fontSize:{activeVal:a||"medium",cont:$(".fika-article"),selects:$(".fika-select-size"),classPrefix:"size-"},theme:{activeVal:t||"vanilla",cont:$(".fika-app"),selects:$(".fika-select-theme"),classPrefix:"theme-"},font:{activeVal:function(){var e=r,a=c.typeface.fonts[c.typeface.default].class;if(e&&"{"===e[0]){var t=JSON.parse(r)[c.typeface.script];return t||a}return a}(),cont:$(".fika-article"),selects:$(".fika-select-font"),classPrefix:"font-"}};function n(a,e){var t,n="",i=f[a].cont;if(i.attr("class").split(/\s+/).forEach(function(e){e.startsWith(f[a].classPrefix)&&(n=e)}),i.removeClass(n),t=""+f[a].classPrefix+e,i.addClass(t),f[a].activeVal=e,"font"===a){var s=r,l=c.typeface.script;if(s&&"{"===s[0])(s=JSON.parse(s))[l]=e,u.module.common.cache.set("font",JSON.stringify(s));else{var o={};o[l]=e,u.module.common.cache.set("font",JSON.stringify(o))}}else u.module.common.cache.set(a,e);f[a].selects.removeClass("active"),f[a].selects.each(function(){$(this).hasClass(t)&&$(this).addClass("active")})}n("theme",f.theme.activeVal),n("fontSize",f.fontSize.activeVal),n("font",f.font.activeVal),f.theme.selects.click(function(){n("theme",$(this).attr("class").split(/\s+/)[1].split("-")[1])}),f.fontSize.selects.click(function(){n("fontSize",$(this).attr("class").split(/\s+/)[1].split("-")[1])}),f.font.selects.click(function(){n("font",$(this).attr("class").split(/\s+/)[1].split("-")[1])})},this.initDrawer=function(){function a(e){e&&t.available?(t.el.addClass("fika-drawer-on"),t.overlay.addClass("fika-overlay-active")):(t.el.removeClass("fika-drawer-on"),t.overlay.removeClass("fika-overlay-active")),t.open=e}(t={open:!1,modal:!1,close:$(".fika-drawer-close"),btn:$("#fika-toc-btn"),el:$(".fika-drawer"),app:$(".fika-app"),overlay:$(".fika-overlay"),w:null,threshold:1552,available:!1}).btn.click(function(){a(!t.open)}),t.close.click(function(){a(!1)}),t.overlay.click(function(){a(!1),u.toggleAppearanceMenu(!1),t.overlay.removeClass("fika-overlay-active")}),window.addEventListener("resize",function(){var e=window.innerWidth;t.available=e<1400,t.btn.toggleClass("disabled",!t.available),t.open&&!t.available&&a(!1),t.w=e}),t.w=window.innerWidth,t.available=t.w<1400,t.btn.toggleClass("disabled",!t.available)},this._initTools=function(){this.ripple(document.querySelectorAll(".fika-btn")),this.initDrawer(),$("#fika-appearance").click(u.toggleAppearanceMenu),$("#fika-print").click(function(){var e=document.createElement("iframe");e.style="height: 0px; width: 0px; position: absolute",document.body.appendChild(e);var a=document.createElement("link");a.rel="stylesheet",a.type="text/css",a.href="chrome-extension://gbgpnkjlajphppfjolpcpffegigiokii/style/content.css",e.contentDocument.head.appendChild(a),$("#fika-reader").clone().appendTo(e.contentDocument.body),e.contentWindow.print()}),$("#fika-fullscreen").click(function(){$(this).toggleClass("fs-on");var e=document.documentElement;document.fullscreenElement&&document.webkitIsFullScreen?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen()});var e=$(".fika-tool");$("#fika-tool-btn").click(function(){e.toggleClass("fika-tool-on"),$(".fika-menu").removeClass("fika-menu-on")});var a=void 0;e.mouseleave(function(){var e=this;a=setTimeout(function(){$(e).removeClass("fika-tool-on"),u.toggleAppearanceMenu(!1)},1200)}),e.mouseenter(function(){clearTimeout(a)}),$("#fika-exit").click(function(){u.module.content.closeReaderMode()});var n=$(".fika-feedback-button");n.click(function(){var e=$(this),a=e.attr("data-match"),t=$("#fika-feedback-msg");n.removeClass("fika-feedback-button-active"),e.addClass("fika-feedback-button-active"),"1"===a?t.html('Thanks for the upvote! <a href="https://chrome.google.com/webstore/detail/fika-reader-mode/fbcdnjeoghampomjjaahjgjghdjdbbcj" target="_blank">Rate Fika</a>'):t.html('Sorry to hear that! <a href="mailto:hi@fika.io?subject=Fika User Feedback" target="_blank">Help use improve</a>')})},this._init=function(e){this._initTools(),chrome.i18n.detectLanguage(e,function(e){for(var a={code:"",percentage:0},t=0;t<e.languages.length;t++)e.languages[t].language+" ",e.languages[t].percentage+"\n",e.languages[t].percentage>a.percentage&&(a.code=e.languages[t].language,a.percentage=e.languages[t].percentage);-1!==l.rtl.indexOf(a.code)&&$(".fika-article").addClass("rtl");for(var n=0;n<l.typeface.length;n++){if(-1!==l.typeface[n].lang.indexOf(a.code)){a.typeface=l.typeface[n];break}3===n&&(a.typeface=l.typeface[3])}u.view.display("reader","fonts",a.typeface.fonts,$(".fika-select-fonts"));var i=$(".fika-content"),s=[];i.find(":header").each(function(){var e=$(this)[0].innerText;if(e){var a=1e4*Math.random();$(this).attr("id",a),s.push({tag:$(this)[0].localName,text:e.trim(),id:a})}}),1<s.length&&u.view.display("reader","toc",s,$(".fika-toc")),i.find("svg").each(function(){$(this).remove()}),u.module.common.cache.get(["fontSize","theme","font"],function(e){u.appearance(a,{fontSize:e[0],theme:e[1],font:e[2]})})})},this.init=function(){}});