"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};App.module.extend("common",function(){var g=this;this.cache={set:function(e,t){chrome.extension.sendMessage({method:"setCache",data:{key:e,value:t}},function(){})},get:function(e,t){chrome.extension.sendMessage({method:"getCache",data:{key:e}},function(e){t(e)})}},this.is_function=function(e){return"[object Function]"===Object.prototype.toString.call(e)},this.object_is_empty=function(e){for(var t in e)return!1;return!0},this.date={now:function(){return(new Date).toLocaleTimeString()}},this.get_url_params=function(e){var t=e.split("?")[1],n=[];if(t)for(var o=t.split("&"),i=o.length,r=0;r<i;r++){var a=o[r].split("=");n.push({key:a[0],val:decodeURIComponent(a[1])})}return n},this.tips={timer:null,show:function(e,t,n){var o=this,i=n||{},r=$("#tips-box");r.remove(),$("body").append(View.get_view("common","tips",{content:t})),r=$("#tips-box"),i.height&&r.css({height:i.height}),this.timer&&clearTimeout(this.timer),e.off("mouseleave").on("mouseleave",function(){o.timer=setTimeout(function(){$("#tips-box").remove()},300)});var a=e.offset(),s=e.outerWidth(),c=e.outerHeight(),l=a.top,d=a.left,u=r.outerWidth(),f=r.outerHeight(),m=g.clientSize("clientWidth"),h=g.clientSize("clientHeight"),p=$(".tips-array");switch(i.position){case"left":d=d-u<=0?d+s:d-u,h<l+f&&(l-=f);break;case"right":p.removeClass("tips-array-right tips-array-top tips-array-bottom").addClass("tips-array-left"),d=m<d+u?d-s-u:d+s+8,h<l+f?(l=h-f,p.css("top",f-24)):p.css("top",8);break;default:m<d+u?(d=d-u+s,l+=c,p.css("right",8)):p.css("left",8),p.removeClass("tips-array-left tips-array-right tips-array-bottom").addClass("tips-array-top"),h<(l+=c)+f&&(l=l-f-c,p.removeClass("tips-array-left tips-array-right tips-array-top").addClass("tips-array-bottom"),p.css({bottom:-8}))}r.css({top:l,left:d}).off("mouseenter").on("mouseenter",function(){clearTimeout(o.timer)}).off("mouseleave").on("mouseleave",function(){$(this).remove()})},remove:function(){$("#tips-box").remove()}},this.notification=function(e,t){var n=null;$("#notification-box").remove(),clearTimeout(n);var o=t||"success";$("body").append(App.view.get_view("common","notification",{text:e,bg:o})),n=setTimeout(function(){$("#notification-box").fadeOut()},2e3)},this.getDate=function(e,t){t=(t=t||"YYYY-MM-DD")||"-";var n=(e=e||0)instanceof Date==!0?e:new Date(Date.now()-24*e*60*60*1e3),o=/([Yy]*)([\\\/\-]?)([Mm]*)([\/\\\-]?)([Dd]*)\s?([Hh]*)?\:?([Mm]*)?\:?([Ss]*)?/g.exec(t),i=o&&o[1]?n.getFullYear():"",r=o&&o[2]?o[2]:"-",a=o&&o[3]?n.getMonth()+1:"",s=o&&o[5]?n.getDate():"",c=o&&o[6]?n.getHours():"",l=o&&o[7]?n.getMinutes():"",d=o&&o[8]?n.getSeconds():"";return i+((a=a&&a<10?"0"+a:a)?r:"")+a+((s=s&&s<10?"0"+s:s)?r:"")+s+((c=c&&c<10?"0"+c:c)?" ":"")+c+((l=l&&l<10?"0"+l:l)?":":"")+l+((d=d&&d<10?"0"+d:d)?":":"")+d},this.secFormatTime=function(e){var t=parseInt(e/86400),n=parseInt(e%86400/3600),o=parseInt(e%3600/60),i=parseInt(e%60);return(t?t+"天":"")+(n?n+"小时":"")+(o?o+"分钟":"")+(i?i+"秒":"")},this.module=function(e,t,n){var o=new Date,i=Date.parse(o.toDateString());$("body").append(this.view.get_view("common","module",{name:e,content:t,action:n,module_id:i})),$(".module-box-"+i).find(".js-handler").attr("data-module-id",i);$(".module-main").outerHeight();$(".module-close").off("click").on("click",function(){var e=$(this).attr("data-module-id");$(".module-box-"+e).remove()}),$(".module-mask").off("click").on("click",function(){var e=$(this).attr("data-module-id");$(".module-box-"+e).remove()})},this.dialog=function(){return{show:function(e,t,n,o){var i=Date.parse(new Date);$("body").append(View.get_view("common","dialog",{type:e,msg:t,dialog_id:i})),$(".dialog-close").off("click").on("click",function(){var e=$(this).attr("data-dialog-id");$(".dialog-"+e).remove(),g.is_function(o)&&o()}),$(".dialog-action-button").off("click").on("click",function(){var e=$(this).attr("data-dialog-id"),t=$(this).attr("data-type");$(".dialog-"+e).remove(),"confirm"===t?g.is_function(n)&&n():g.is_function(o)&&o()})},confirm:function(e,t,n){this.show("confirm",e,t,n)},ok:function(e,t,n){this.show("ok",e,t,n)}}},this.getFormParams=function(){return{get_data:function(e,o){var i=o?new FormData:{},r={},a=0,t=e.find(".form-select"),s=e.find(".form-key"),c=e.find(".form-value-data-type"),l=e.find(".form-value"),d=e.find(".form-description");return t.each(function(){if($(this).is(":checked")){var e=$.trim(s.eq(a).val());if(e){var t=$.trim(l.eq(a).val()),n="Text";o?"File"===c.eq(a).val()?(i.append(e,l.eq(a)[0].files[0]),n="File"):i.append(e,t):i[e]=t,r[e]={value:t,value_type:n,description:$.trim(d.eq(a).val())}}}a++}),{data:i,history_data:r}},header:function(){return this.get_data($("#form-data-headers"))},form:function(){return this.get_data($("#form-data"))},form_data:function(){return this.get_data($("#form-data"),!0)}}},this.get_response_content_type_text=function(e){var t="UNKNOWN";return e&&(-1!==e.indexOf("application/json")?t="JSON":-1!==e.indexOf("image")?t="IMG":-1!==e.indexOf("text/xml")||-1!==e.indexOf("application/xml")?t="XML":-1!==e.indexOf("text/html")?t="HTML":-1!==e.indexOf("text/plain")&&(t="TEXT")),t},this.get_response_content_type=function(e,t){e?-1!==e.indexOf("application/json")?t("json"):-1!==e.indexOf("image")?t("img"):-1!==e.indexOf("text/xml")||-1!==e.indexOf("application/xml")?t("xml"):-1!==e.indexOf("text/html")&&t("html"):t("")},this.syntaxHighlight=function(e){return e?(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(e){var t="code-number";return/^"/.test(e)?t=/:$/.test(e)?"code-key":"code-string":/true|false/.test(e)?t="code-boolean":/null/.test(e)&&(t="code-null"),'<span class="'+t+'">'+e+"</span>"}):"Server error. Please check the api server."},this.getHost=function(e){if(!e)return!1;return/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(e)},this.hasHost=function(e){if(!e)return!1;var t=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.exec(e);return!!(t[1]&&t[2]&&t[3])},this.cajax=function(o,i){chrome.tabs.getCurrent(function(e){var t=o.data?o.data:{};o.need_token&&(t.token=localStorage.getItem("token")),console.log(t);var n={tab_id:e.id,url:o.url,callback_method:o.callback_method,callback_module:o.callback_module,data:t,params:{type:o.request_type,headers:{"Content-Type":"application/x-www-form-urlencoded"}}};chrome.extension.sendMessage(n,function(e){i(e)})})},this.request=function(e,t,n,o){var i=t.type?t.type:"GET",r=new XMLHttpRequest;r.addEventListener("readystatechange",function(){switch(this.readyState){case 1:break;case 2:g.get_response_content_type(this.getResponseHeader("content-type"),function(e){switch(e){case"json":r.responseType="json";break;case"img":"bytes"===r.getResponseHeader("accept-ranges")&&(r.responseType="blob")}});break;case 3:break;case 4:g.is_function(o)&&o(this.response,this)}});var a=null;if("GET"===i){if(e+=-1===e.indexOf("?")?"?":"&","object"===(void 0===n?"undefined":_typeof(n))){for(var s in a=[],n)n.hasOwnProperty(s)&&a.push(s+"="+n[s]);e+=encodeURI(a.join("&"))}}else switch(t.headers["Content-Type"]){case"application/x-www-form-urlencoded":for(var c in a=[],n)n.hasOwnProperty(c)&&a.push(c+"="+n[c]);a=encodeURI(a.join("&"));break;default:a=n}if(r.open(i,e,"false"!==t.async),t.headers)for(var l in t.headers)t.headers.hasOwnProperty(l)&&r.setRequestHeader(l,t.headers[l]);r.addEventListener("error",function(){console.log("request error.")}),r.send(a)},this.clientSize=function(e){var t=[];return t.scrollTop=window.self.document.documentElement.scrollTop?window.self.document.documentElement.scrollTop:window.self.document.body.scrollTop,t.scrollHeight=window.self.document.documentElement.scrollHeight?window.self.document.documentElement.scrollHeight:window.self.document.body.scrollHeight,t.clientHeight=window.self.document.documentElement.clientHeight?window.self.document.documentElement.clientHeight:window.self.document.body.clientHeight,t.clientWidth=window.self.document.documentElement.clientWidth?window.self.document.documentElement.clientWidth:window.self.document.body.clientWidth,t[e]},this.md5=function(e){function c(e,t){return e<<t|e>>>32-t}function l(e,t){var n,o,i,r,a;return i=2147483648&e,r=2147483648&t,a=(1073741823&e)+(1073741823&t),(n=1073741824&e)&(o=1073741824&t)?2147483648^a^i^r:n|o?1073741824&a?3221225472^a^i^r:1073741824^a^i^r:a^i^r}function t(e,t,n,o,i,r,a){var s;return l(c(e=l(e,l(l((s=t)&n|~s&o,i),a)),r),t)}function n(e,t,n,o,i,r,a){var s;return l(c(e=l(e,l(l(t&(s=o)|n&~s,i),a)),r),t)}function o(e,t,n,o,i,r,a){return l(c(e=l(e,l(l(t^n^o,i),a)),r),t)}function i(e,t,n,o,i,r,a){return l(c(e=l(e,l(l(n^(t|~o),i),a)),r),t)}function r(e){var t,n="",o="";for(t=0;t<=3;t++)n+=(o="0"+(e>>>8*t&255).toString(16)).substr(o.length-2,2);return n}var a,s,d,u,f,m,h,p,g,v=Array();for(v=function(e){for(var t,n=e.length,o=n+8,i=16*((o-o%64)/64+1),r=Array(i-1),a=0,s=0;s<n;)a=s%4*8,r[t=(s-s%4)/4]=r[t]|e.charCodeAt(s)<<a,s++;return a=s%4*8,r[t=(s-s%4)/4]=r[t]|128<<a,r[i-2]=n<<3,r[i-1]=n>>>29,r}(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var o=e.charCodeAt(n);o<128?t+=String.fromCharCode(o):(127<o&&o<2048?t+=String.fromCharCode(o>>6|192):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128)),t+=String.fromCharCode(63&o|128))}return t}(e)),m=1732584193,h=4023233417,p=2562383102,g=271733878,a=0;a<v.length;a+=16)h=i(h=i(h=i(h=i(h=o(h=o(h=o(h=o(h=n(h=n(h=n(h=n(h=t(h=t(h=t(h=t(d=h,p=t(u=p,g=t(f=g,m=t(s=m,h,p,g,v[a+0],7,3614090360),h,p,v[a+1],12,3905402710),m,h,v[a+2],17,606105819),g,m,v[a+3],22,3250441966),p=t(p,g=t(g,m=t(m,h,p,g,v[a+4],7,4118548399),h,p,v[a+5],12,1200080426),m,h,v[a+6],17,2821735955),g,m,v[a+7],22,4249261313),p=t(p,g=t(g,m=t(m,h,p,g,v[a+8],7,1770035416),h,p,v[a+9],12,2336552879),m,h,v[a+10],17,4294925233),g,m,v[a+11],22,2304563134),p=t(p,g=t(g,m=t(m,h,p,g,v[a+12],7,1804603682),h,p,v[a+13],12,4254626195),m,h,v[a+14],17,2792965006),g,m,v[a+15],22,1236535329),p=n(p,g=n(g,m=n(m,h,p,g,v[a+1],5,4129170786),h,p,v[a+6],9,3225465664),m,h,v[a+11],14,643717713),g,m,v[a+0],20,3921069994),p=n(p,g=n(g,m=n(m,h,p,g,v[a+5],5,3593408605),h,p,v[a+10],9,38016083),m,h,v[a+15],14,3634488961),g,m,v[a+4],20,3889429448),p=n(p,g=n(g,m=n(m,h,p,g,v[a+9],5,568446438),h,p,v[a+14],9,3275163606),m,h,v[a+3],14,4107603335),g,m,v[a+8],20,1163531501),p=n(p,g=n(g,m=n(m,h,p,g,v[a+13],5,2850285829),h,p,v[a+2],9,4243563512),m,h,v[a+7],14,1735328473),g,m,v[a+12],20,2368359562),p=o(p,g=o(g,m=o(m,h,p,g,v[a+5],4,4294588738),h,p,v[a+8],11,2272392833),m,h,v[a+11],16,1839030562),g,m,v[a+14],23,4259657740),p=o(p,g=o(g,m=o(m,h,p,g,v[a+1],4,2763975236),h,p,v[a+4],11,1272893353),m,h,v[a+7],16,4139469664),g,m,v[a+10],23,3200236656),p=o(p,g=o(g,m=o(m,h,p,g,v[a+13],4,681279174),h,p,v[a+0],11,3936430074),m,h,v[a+3],16,3572445317),g,m,v[a+6],23,76029189),p=o(p,g=o(g,m=o(m,h,p,g,v[a+9],4,3654602809),h,p,v[a+12],11,3873151461),m,h,v[a+15],16,530742520),g,m,v[a+2],23,3299628645),p=i(p,g=i(g,m=i(m,h,p,g,v[a+0],6,4096336452),h,p,v[a+7],10,1126891415),m,h,v[a+14],15,2878612391),g,m,v[a+5],21,4237533241),p=i(p,g=i(g,m=i(m,h,p,g,v[a+12],6,1700485571),h,p,v[a+3],10,2399980690),m,h,v[a+10],15,4293915773),g,m,v[a+1],21,2240044497),p=i(p,g=i(g,m=i(m,h,p,g,v[a+8],6,1873313359),h,p,v[a+15],10,4264355552),m,h,v[a+6],15,2734768916),g,m,v[a+13],21,1309151649),p=i(p,g=i(g,m=i(m,h,p,g,v[a+4],6,4149444226),h,p,v[a+11],10,3174756917),m,h,v[a+2],15,718787259),g,m,v[a+9],21,3951481745),m=l(m,s),h=l(h,d),p=l(p,u),g=l(g,f);return(r(m)+r(h)+r(p)+r(g)).toLowerCase()}});