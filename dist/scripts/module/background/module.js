"use strict";App.module.extend("background",function(){var i=this;this.init=function(){chrome.browserAction.onClicked.addListener(function(t){chrome.tabs.sendMessage(t.id,{method:"openReaderMode"},function(t){})}),chrome.extension.onMessage.addListener(function(t,e,n){var o=t.method;$.isFunction(i[o])?i[o](t.data,n):i.log("Background ["+o+"] not exist.")})},this.reader_ready=function(t,e){var n=t.is_available;chrome.tabs.query({active:!0,currentWindow:!0},function(t){n?chrome.browserAction.setIcon({path:{64:"images/logo64.png"},tabId:t[0].id},function(){}):chrome.browserAction.setIcon({path:{64:"images/logo64-grey.png"},tabId:t[0].id},function(){})}),Version.notice(),e("")},this.is_open=function(t,e){if(!t)return i.badge_text.off(),e(!1),!1;i.badge_text.on(),e(!0)},this.badge_text={on:function(){this.run("on")},off:function(){this.run("")},run:function(e){chrome.tabs.query({active:!0,currentWindow:!0},function(t){chrome.browserAction.setBadgeText({text:e,tabId:t[0].id},function(){})})}},this.setCache=function(t,e){var n=t.key,o=t.value;localStorage.setItem(n,o),e("")},this.getCache=function(t,e){var n=[];"[object Array]"===Object.prototype.toString.call(t.key)?t.key.forEach(function(t){n.push(localStorage.getItem(t))}):n.push(localStorage.getItem(t.key)),e(n)},this.feedback=function(o,t){chrome.tabs.query({active:!0,currentWindow:!0},function(n){$.post("http://www.yuiapi.com/api/v1/fika/feedback",{url:n[0].url,is_match:o.is_match},function(t){var e=!1;t&&0===t.code&&(e=!0),chrome.tabs.sendMessage(n[0].id,{method:"feedbackResponse",data:{is_match:o.is_match,success:e}},function(t){})})}),t("")}});